<!-- HTML for search results -->

<html>
	<head>

		<style type="text/css">
			h1{
				font-size: 70px;
				font-family: 'Rockwell Extra Bold', 'Rockwell Bold', monospace;
				font-weight:bold;
				color: white;
			}
			h2{
				text-align:center;
				color: #336699;
			}
			html{
				background: url(globeSearch.jpg) no-repeat;
				background-attachment: fixed;
				-webkit-background-size: cover;
				-moz-background-size: cover;
				-o-background-size: cover;
				background-size: cover; 
			}
			a{
				font-size:17px;
				color:black;
				font-style: italic;
				text-shadow: 1px 1px 0px white;
			}
			a:hover{
				font-size:17px;
				color:blue;
				font-style: normal;
				text-shadow: 1px 1px 0px white;
			}
			.myButtons{
				color: black;
				background-color: #ffcccc;
    			width: 32em;
    			height: 6em;
    			border-radius: 10px;
			}
			.myButtons:hover{
				background-color: #ff1a1a;
			}
			#message{
				font-size: 30px;
				font-family: 'Rockwell Extra Bold', 'Rockwell Bold', monospace;
				font-weight:bold;
				color: yellow;
			}
			#popup, .bMulti {
    			background-color: #FFF;
    			border-radius: 10px 10px 10px 10px;
    			box-shadow: 0 0 25px 5px #999;
    			color: #111;
    			display: none;
    			min-width: 350px;
    			min-height: 150px;
    			padding: 25px;
			}
			#popup .logo {
   				color: #2B91AF;
    			font: bold 325% 'Petrona',sans;
    			text-align: center;
			}
			.button.b-close, .button.bClose {
    			border-radius: 7px 7px 7px 7px;
    			box-shadow: none;
    			font: bold 131% sans-serif;
    			padding: 0 6px 2px;
    			position: absolute;
    			right: -7px;
    			top: -7px;
			}
			.button {
    			background-color: #2B91AF;
    			border-radius: 10px;
    			box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
    			color: #FFF;
    			cursor: pointer;
    			display: inline-block;
    			padding: 10px 20px;
    			text-decoration: none;
			}
			
		</style>

		<script src="http://code.jquery.com/jquery-1.11.3.min.js"></script>
		<script src="http://code.jquery.com/ui/1.11.1/jquery-ui.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
		<script src="http://dinbror.dk/bpopup/assets/jquery.bpopup-0.9.4.min.js"></script>
		<script src="http://dinbror.dk/bpopup/assets/jquery.easing.1.3.js"></script>
		<script type="text/javascript">

		function goToErrorPage(){
			window.location = 'http://localhost:3000/error.html';
		}


		$(document).ready(function(){

			if(localStorage.getItem('search') != "[]"){
				document.getElementById('theElements').appendChild(document.createElement("BR"));
				document.getElementById('theElements').appendChild(document.createElement("BR"));
				var buttons = [];
				var places = JSON.parse(localStorage.getItem('places'));
				var completed = JSON.parse(localStorage.getItem('completed'));
				var locations = JSON.parse(localStorage.getItem('search'));
				for(var i = 0; i < locations.length; i++){
					console.log(locations[i]);
					var theLoc = locations[i];
					buttons[i] = document.createElement("BUTTON");
					var name = document.createTextNode(locations[i].name);
					var lineBreak1 = document.createElement("BR");
					var lineBreak2 = document.createElement("BR");
					var city = document.createTextNode(locations[i].city);
					var state = document.createTextNode(locations[i].state);
					var country = document.createTextNode(locations[i].country);
					var comma1 = document.createTextNode(", ");
					var comma2 = document.createTextNode(", ");
					var type = document.createTextNode(locations[i].type);

					for(var j = 0; j < places.length; j++){
						if(places[j].name == locations[i].name && places[j].city === locations[i].city && places[j].state === locations[i].state && places[j].country == locations[i].country){
							buttons[i].setAttribute("disabled","disabled");
							buttons[i].style.backgroundColor = "#d9d9d9";
							break;
						}
					}

					for(var k = 0; k < completed.length; k++){
						if(completed[k].name === locations[i].name && completed[k].city === locations[i].city && completed[k].state === locations[i].state && completed[k].country == locations[i].country){
							buttons[i].setAttribute("disabled","disabled");
							buttons[i].style.backgroundColor = "#d9d9d9";
							break;
						}
					}

					buttons[i].setAttribute("id", JSON.stringify(locations[i]));
					buttons[i].setAttribute("class", "myButtons");
					buttons[i].setAttribute("width", "400px");
					console.log(buttons[i].getAttribute('id'));
					buttons[i].style.textAlign = 'left';
					buttons[i].style.fontSize = '15px';
					buttons[i].appendChild(name);
					buttons[i].appendChild(lineBreak1);
					buttons[i].appendChild(city);
					buttons[i].appendChild(comma1);
					buttons[i].appendChild(state);
					buttons[i].appendChild(comma2);
					buttons[i].appendChild(country);
					buttons[i].appendChild(lineBreak2);
					buttons[i].appendChild(type);
					buttons[i].addEventListener('click', myFunction);					
					document.getElementById('theElements').appendChild(buttons[i]);
					//document.getElementById('theElements').appendChild(document.createElement("BR"));
					//document.getElementById('theElements').appendChild(document.createElement("BR"));
				}
			} else {
				$('#message').text("You have no places or events to display at this time.");
			}
			
			function myFunction(){

				var id = this.id;
				var info = JSON.parse(this.id);

				$.ajax({
					url: "places/" + localStorage.getItem('username') + "/" + localStorage.getItem('password'),
					type: "POST",
					dataType: "json",
					data: { name: info.name,
							type: info.type,
							city: info.city,
							state: info.state,
							country: info.country},
					success: function(data){
						console.log(data);
						if(data.username){
							//add places to the local storage
							localStorage['places'] = data.places;
							//disable the button and change the color to a light green
							document.getElementById(id).setAttribute("disabled","disabled");
							document.getElementById(id).style.backgroundColor = "#99ff99";
							//create a popup that lasts 2 seconds to tell the user that the item was added to their list
							$('#popup').empty();
							$('#popup').bPopup({
								speed: 650,
            					transition: 'slideIn',
	    						transitionClose: 'slideBack',
            					autoClose: 2000,
            					positionStyle: 'fixed'
							});
							var html = $("#popup").html();
                			$("#popup").html(html + "<br>Successfully added:<br><br>" + info.name + "<br>" + info.city + ", " + info.state + ", " + info.country + "<br>" + info.type + "<br><br> to your bucket list");

						} else {

							$('#popup').bPopup({
								speed: 650,
            					transition: 'slideIn',
	    						transitionClose: 'slideBack',
            					autoClose: 2000,
            					positionStyle: 'fixed'
							});
							var html = $("#popup").html();
                			$("#popup").html(html + "<br>Could not add<br>" + info.name + "<br>" + info.city + ", " + info.state + ", " + info.country + "<br>" + info.type + "<br><br> to your bucket list");
						}
					}
				});				
			}
		});

		</script>

	</head>

	<body>

		<h1 align="center" id="bucket">Search Results</h1>
		<div style="position: absolute; top:350px; left:250px; width:900px; height:30px" id="message"></div>
		<p style="position: absolute; top:180px; left:1180px; width:150px; height:30px"><a href="http://localhost:3000/test.html">Return to Homepage</a></p>
		<p style="position: absolute; top:220px; left:1180px; width:150px; height:30px"><a href="http://localhost:3000/search.html">Search Again</a></p>
		<h2><div id="theElements"></div></h2>
		<div id="popup"></div>
	</body>
</html>